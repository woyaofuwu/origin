<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!--$Id: CreatePersonUser.html,v 1.13 2013/04/26 07:06:12 sunxin Exp $-->
<html xmlns="http://www.w3.org/1999/xhtml">
<head jwcid="@Head"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>新增副设备</title>
<script jwcid="@Script" type="text/javascript" src="scripts/csserv/common/developstaff/DevelopStaff.js"></script>
<script jwcid="@Script" type="text/javascript" src="person/createusertrade/scripts/psptcard.js"></script>
<script jwcid="@Script" type="text/javascript" src="person/singlenumbermultidevice/adddevice/scripts/adddevice.js"></script>
<script jwcid="@Script" type="text/javascript" src="person/scripts/simcardmgr/simcard.js"></script>
<script jwcid="@Script" type="text/javascript" src="person/scripts/simcardmgr/rps.js"></script>
<script jwcid="@Script" type="text/javascript" src="scripts/csserv/common/tradecheck/TradeCheck.js"></script>
<script jwcid="@Script" type="text/javascript" src="scripts/csserv/component/fee/FeeMgr.js"></script>
<script jwcid="@Script" type="text/javascript" src="scripts/csserv/component/businesstip/businesstip.js"></script>
<script jwcid="@Script" type="text/javascript" src="scripts/csserv/common/validate/custvalidate.js" ></script>
<script jwcid="@Script" type="text/javascript" src="person/scripts/simcardmgr/simcard4usim.js"></script>
<script jwcid="@Script" type="text/javascript" src="person/scripts/simcardmgr/getusiminfo.js"></script>

</head>
<body jwcid="@Body"><div class="m_wrapper"><div class="m_wrapper2">
	<!--身份识别系统-->
	<span id="PsptControlOCX" style="display:none;" ></span> 
	<!--读写卡系统-->
	<object name="RpsClient"
		classid="CLSID:B2ED220B-F358-4A48-A724-937545220D89" width="1"
		height="1" VIEWASTEXT>
	</object>
	<object classid="clsid:8FEEA6DC-31F9-42A7-B42E-EB2EACE5FD57"
	id="downocx2" name="downocx2" CODEBASE="./GMCCRpsOcx.ocx#version=1,0,0,1"
	style="display: none"></object>
<div  id="HINT" class="c_tip" style="display:none"></div>
<!-- 隐藏区域 开始 -->
<div class="" jwcid="InitInfoHidePart@Part" style="display:none;">
	<input jwcid="@Hidden" name="OPEN_TYPE" id="OPEN_TYPE" value="ognl:initInfo.OPEN_TYPE" desc="开户方式"/>
	<input jwcid="@Hidden" name="IS_AGENT" id="IS_AGENT" value="ognl:initInfo.IS_AGENT" desc="是否可以选择代理商"/>
	<!--  暂时没发现使用    -->
	<input jwcid="@Hidden" name="PROVINCE" id="PROVINCE" value="ognl:initInfo.PROVINCE" desc="获取本省代码"/>
	<input jwcid="@Hidden" name="SHOW_HINT_INFO" id="SHOW_HINT_INFO" value="ognl:initInfo.SHOW_HINT_INFO" desc="获取是否显示用户提示信息的标记"/>
	<input jwcid="@Hidden" name="CITY_CODE_HANDLE" id="CITY_CODE_HANDLE" value="ognl:initInfo.CITY_CODE_HANDLE" desc="获取业务区句柄"/>
	<input jwcid="@Hidden" name="IS_AFRESH_PRINT" id="IS_AFRESH_PRINT" value="ognl:initInfo.IS_AFRESH_PRINT" desc="获取是否提示重新打印标志"/><input jwcid="@Hidden" name="DEFAULT_USER_TYPE" id="DEFAULT_USER_TYPE" value="ognl:initInfo.DEFAULT_USER_TYPE" desc="默认用户类型"/>
	<input jwcid="@Hidden" name="DEFAULT_PSPT_TYPE" id="DEFAULT_PSPT_TYPE" value="ognl:initInfo.DEFAULT_PSPT_TYPE" desc="默认证件类型"/>
	<input jwcid="@Hidden" name="DEFAULT_PAY_MODE" id="DEFAULT_PAY_MODE" value="ognl:initInfo.DEFAULT_PAY_MODE" desc="默认帐户类型"/>
	<input jwcid="@Hidden" name="DEPART_KIND_CODE" id="DEPART_KIND_CODE" value="ognl:initInfo.DEPART_KIND_CODE" desc="登录部门类型"/>
	<input jwcid="@Hidden" name="checkGlobalMorePsptIdFlag" id="checkGlobalMorePsptIdFlag" value="true" desc="是否进行全国1证5号校验"/>	
	
</div>

<div class="" jwcid="TradeInfoHidePart@Part" >
	<input jwcid="@Hidden" name="OLD_SERIAL_NUMBER_B" id="OLD_SERIAL_NUMBER_B" value="ognl:editInfo.OLD_SERIAL_NUMBER_B" desc="原号码"/>
	<input jwcid="@Hidden" name="OLD_SIM_CARD_NO_B" id="OLD_SIM_CARD_NO_B" value="ognl:editInfo.OLD_SIM_CARD_NO_B" desc="原SIM卡号"/>
	<input jwcid="@Hidden" name="OLD_PSPT_TYPE_CODE" id="OLD_PSPT_TYPE_CODE" value="ognl:editInfo.OLD_PSPT_TYPE_CODE" desc="原证件类型"/>
	<input jwcid="@Hidden" name="OLD_PSPT_ID" id="OLD_PSPT_ID" value="ognl:editInfo.OLD_PSPT_ID" desc="原证件号码"/>
	<input jwcid="@Hidden" name="CHECK_PSPT_CODE" id="CHECK_PSPT_CODE" value="ognl:editInfo.CHECK_PSPT_CODE" desc="证件校验通过标志"/>
    <input jwcid="@Hidden" name="REALNAME_LIMIT_CHECK_RESULT" id="REALNAME_LIMIT_CHECK_RESULT" value="false" desc="实名制验证标记"/>
    <input jwcid="@Hidden" name="REAL_NAME" id="REAL_NAME" value="1" desc="实名制选择标记"/>
    <input jwcid="@Hidden" name="ACTIVE_TAG" id="ACTIVE_TAG" value="0" desc="激活标记"/>
	<input jwcid="@Hidden" name="PRI_PSPT_ID" id="PRI_PSPT_ID" value="0" desc="主号码证件ID"/>
	<input jwcid="@Hidden" name="PRI_PSPT_TYPE_CODE" id="PRI_PSPT_TYPE_CODE" value="0" desc="主号码证件类型"/></div>
<div class="" jwcid="CheckSerialNumberHidePart@Part" >
    <input jwcid="@Hidden" name="CHECK_DEPART_ID" id="CHECK_DEPART_ID" value="ognl:editInfo.CHECK_DEPART_ID" desc="代理商开户资源校验部门"/>
    <input jwcid="@Hidden" name="B_SAME_EPARCHY_CODE" id="B_SAME_EPARCHY_CODE" value="ognl:editInfo.B_SAME_EPARCHY_CODE" desc="是否异地办理 0-非异地 1-异地"/>
    <input jwcid="@Hidden" name="B_DIFF_TRADE" id="B_DIFF_TRADE" value="ognl:editInfo.B_DIFF_TRADE" desc="是否登记省中心台帐:0:登记;1:不登记"/>
    <!--input jwcid="@Hidden" name="OPEN_TYPE" id="OPEN_TYPE" value="ognl:editInfo.OPEN_TYPE" desc="开户类型"/-->
    <input jwcid="@Hidden" name="CHECK_RESULT_CODE" id="CHECK_RESULT_CODE" value="-1" desc="号码和sim卡校验通过标志"/>
    <input jwcid="@Hidden" name="CHOICE_GetCodeMode" id="CHOICE_GetCodeMode" value="ognl:editInfo.CHOICE_GetCodeMode" desc="网上选号类型"/>
    <input jwcid="@Hidden" name="CHOICE_NetUsrpid" id="CHOICE_NetUsrpid" value="ognl:editInfo.CHOICE_NetUsrpid" desc="网上选号密码"/>
    <input jwcid="@Hidden" name="SPEC_PRE_PAY_TYPE" id="SPEC_PRE_PAY_TYPE" value="ognl:editInfo.SPEC_PRE_PAY_TYPE" desc="特殊预存缴费"/>
    <input jwcid="@Hidden" name="PRE_CODE_TAG" id="PRE_CODE_TAG" value="ognl:editInfo.PRE_CODE_TAG" desc="预配标记"/>
    <input jwcid="@Hidden" name="EPARCHY_CODE" id="EPARCHY_CODE" value="ognl:editInfo.EPARCHY_CODE" desc="开户号码地州"/>
    <input jwcid="@Hidden" name="PRODUCT_ID" id="PRODUCT_ID" value=""/>
	<input jwcid="@Hidden" name="OLD_NET_CHOOSE_ID" id="OLD_NET_CHOOSE_ID" value=""/>
	<input jwcid="@Hidden" name="BRAND_CODE" id="BRAND_CODE" value=""/>
	<input jwcid="@Hidden" name="NEW_PRODUCT_START_DATE" id="NEW_PRODUCT_START_DATE" value=""/>
	<input jwcid="@Hidden" name="EXISTS_BIND_BRAND" id="EXISTS_BIND_BRAND" value="ognl:editInfo.EXISTS_BIND_BRAND" desc="只能为全球通品牌"/>
	<input jwcid="@Hidden" name="EXISTS_MULTE_PRODUCT" id="EXISTS_MULTE_PRODUCT" value="ognl:editInfo.EXISTS_MULTE_PRODUCT" desc="全球通的产品中不能为两个产品"/>
</div>
<div class="" jwcid="OtherInfoHidePart@Part" style="display:none">
<input jwcid="@Hidden" name="INFO_TAG" id="INFO_TAG" value="0" desc="是否为网上选号"/>
<input jwcid="@Hidden" name="SALE_PRODUCT_ID" id="SALE_PRODUCT_ID" value="" desc="营销活动产品id"/>
<input jwcid="@Hidden" name="SALE_PACKAGE_ID" id="SALE_PACKAGE_ID" value="" desc="营销活动包id"/>
<input jwcid="@Hidden" name="BIND_SALE_TAG" id="BIND_SALE_TAG" value="0" desc="是否绑定营销活动"/>
</div>
<div class="" jwcid="CheckSimCardNoHidePart@Part" style="display:none">
    <input jwcid="@Hidden" name="RES_KIND_NAME" id="RES_KIND_NAME" value="ognl:editInfo.RES_KIND_NAME" desc="卡类型名称"/>
    <input jwcid="@Hidden" name="RES_KIND_CODE" id="RES_KIND_CODE" value="ognl:editInfo.RES_KIND_CODE" desc="卡类型编码"/>
	<input jwcid="@Hidden" name="IMSI" id="IMSI" value="ognl:editInfo.IMSI" />
    <input jwcid="@Hidden" name="KI" id="KI" value="ognl:editInfo.KI" />
    <input jwcid="@Hidden" name="OPC_CODE" id="OPC_CODE" value="ognl:editInfo.OPC_CODE" />
    <input jwcid="@Hidden" name="OPC_VALUE" id="OPC_VALUE" value="ognl:editInfo.OPC_VALUE" />
    <input jwcid="@Hidden" name="SIM_FEE_TAG" id="SIM_FEE_TAG" value="ognl:editInfo.SIM_FEE_TAG" />
    <input jwcid="@Hidden" name="SIM_CARD_SALE_MONEY" id="SIM_CARD_SALE_MONEY" value="ognl:editInfo.SIM_CARD_SALE_MONEY" />
    <input jwcid="@Hidden" name="MAIN_RSRV_STR8" id="MAIN_RSRV_STR8" value="ognl:editInfo.MAIN_RSRV_STR8" desc="主台账预留字段需要"/>
    <input jwcid="@Hidden" name="NEW_AGENT_SALE_TAG" id="NEW_AGENT_SALE_TAG" value="ognl:editInfo.NEW_AGENT_SALE_TAG" desc="主台账预留字段需要"/>
    <input jwcid="@Hidden" name="FLAG_4G" id="FLAG_4G" value="ognl:editInfo.FLAG_4G" desc="4G"/>
    <input jwcid="@Hidden" name="SIM_TYPE_CODE" id="SIM_TYPE_CODE" value="ognl:editInfo.SIM_TYPE_CODE" desc="卡类型"/>
    <input jwcid="@Hidden" name="CAPACITY_TYPE_CODE" id="CAPACITY_TYPE_CODE" value="ognl:editInfo.CAPACITY_TYPE_CODE" desc="卡容量"/>
    <input jwcid="@Hidden" name="EMPTY_CARD_ID" id="EMPTY_CARD_ID" value="ognl:editInfo.EMPTY_CARD_ID" desc="白卡id"/>
    <input jwcid="@Hidden" name="CARD_KIND_CODE" id="CARD_KIND_CODE" value="ognl:editInfo.CARD_KIND_CODE" desc="sim的小类编码"/>
    <input jwcid="@Hidden" name="RES_TYPE_CODE" id="RES_TYPE_CODE" value="ognl:editInfo.RES_TYPE_CODE" desc="sim的编码"/>
    <input jwcid="@Hidden" name="CARD_PASSWD" id="CARD_PASSWD" value="ognl:editInfo.CARD_PASSWD" desc="初始化密码"/>
    <input jwcid="@Hidden" name="PASSCODE" id="PASSCODE" value="ognl:editInfo.PASSCODE" desc="密码因子"/>
    <input jwcid="@Hidden" name="DEFAULT_PWD_FLAG" id="DEFAULT_PWD_FLAG" value="0" desc="是否使用初始密码"/>
    <input jwcid="@Hidden" name="RES_FLAG_4G" id="RES_FLAG_4G" value="ognl:editInfo.RSRV_STR5" desc="资料返回的2、3、4G标识"/>
</div>

<!-- 隐藏区域 结束 -->

<div class="c_box">

	<div class="c_title">
		<div class="text">客户查询</div>
	</div>
<!-- 认证 开始 -->
<div jwcid="AuthPart@csserv:Auth"  tradeTypeCode="396"  tradeAction="refreshPartAtferAuth(data)"  element="div"></div>
<!-- 认证 结束 -->
<div class="c_form c_form-text c_form-col-3 c_form-label-7" jwcid="userInfoPart@Part"> 
	<ul class="ul">			
		<li class="li">
			<span class="label">客户名称：</span> 
			<span class="text" jwcid="@Insert"   value="ognl:custInfo.CUST_NAME" desc="客户名称"/>
		</li>
		<li class="li">
			<span class="label">证件类型：</span>
			<span class="text" jwcid="@Insert"  
						value="ognl:pageutil.getStaticValue('TD_S_PASSPORTTYPE',custInfo.PSPT_TYPE_CODE)"></span>
		</li>			
		<li class="li">
			<span class="label">证件号码：</span>
			<span class="text" jwcid="@Insert"  value="ognl:custInfo.PSPT_ID"></span> 
		</li> 
		<li class="li col-2">
			<span class="label">证件地址：</span>
			<span class="text" jwcid="@Insert"  value="ognl:custInfo.PSPT_ADDR"></span>
		</li> 
	</ul>
</div>
<div jwcid="UCAViewPart@Part">
	<div jwcid="@csserv:UserInfoView" userInfoView="ognl:userInfoView" />
</div>
</div>


<!-- 区域 开始 -->
<div class="c_box">
	<!-- 标题 开始 -->
	<div class="c_title">
		<div class="text">副设备信息</div>
		<div class="fn">
		</div>
	</div>
	<!-- 标题 结束 -->

	
	<div jwcid="BaseInfoPart@Part">
		<!-- 表单 开始 -->
		<div class="c_form c_form-col-3 c_form-label-6">
			<ul class="ul">
			<li class="li">
					<span class="label"><span class="e_required">副设备昵称：</span></span>
						<span class="e_input"><span>
					<input jwcid="@TextField" name="AUX_NICK_NAME" id="AUX_NICK_NAME" value="ognl:editInfo.AUX_NICK_NAME" nullable="no" desc="副设备昵称" maxlength="32"/>
				</span></span>
				</li>
				<li class="li col-2">
				</li>
				<li class="li">
					<span class="label"><span class="e_required">副设备号码：</span></span>
						<span class="e_elements" id="SERIAL_NUMBER_INPUT">
							<button type="button" class="e_button-right" onclick="checkOldSNPwd();"><i class="e_ico-check"></i><span>校验</span></button>
							<span class="e_input e_input-left"><span>
								<input jwcid="@TextField"   name="SERIAL_NUMBER_B" id="SERIAL_NUMBER_B" value="ognl:editInfo.SERIAL_NUMBER_B" 
								desc="副设备号码" nullable="no" maxLength="ognl:initInfo.MAX_LENGTH" datatype="mbphone"
                                enterAction="checkOldSNPwd()" onblur="checkOldSNPwd()" />

							</span></span>
						</span>
				</li>
				<li class="li col-2">
					<span class="label"><span class="e_required">SIM卡号：</span></span>
					<span class="e_elements" id="SIM_CARD_INPUT">
						<!-- ------------------------------TODO 读卡写卡------------------------ -->
						<button type="button" class="e_button-center" onclick="checkSimCardNo()"><i class="e_ico-check"></i><span>校验</span></button>
						<div jwcid="@csserv:WriteCard" mode="1" tradeTypeCode="10" isRender="false" readBeforeAction="beforeReadCard()"readAfterAction="beforeCheckSimCardNo(data)" writeAfterAction="afterWriteCard(data)"/>
						<span class="e_input e_input-left"><span>
							<input jwcid="@TextField" name="SIM_CARD_NO_B" id="SIM_CARD_NO_B" value="ognl:editInfo.SIM_CARD_NO_B" 
								desc="SIM卡号" nullable="no" onblur="checkSimCardNo(0)" enterAction="checkSimCardNo(1)" />
						</span></span>
					</span>
				</li>
			</ul>
		</div>
		<!-- 表单 结束 -->
		</div>
		</div>
		
		<div jwcid="CustInfoFieldPart@csserv:CustInfoField" isRealName="true" blackTradeType="10" element="div" requiredField="PSPT_TYPE_CODE,PSPT_ID,CUST_NAME,PSPT_ADDR,USER_TYPE_CODE,CALLING_TYPE_CODE,PHONE,BIRTHDAY,AGENT_PIC_ID"/>


<!-- 区域 开始 -->
<div class="c_box">

	<div jwcid="SubmitPart@csserv:CSSubmit" beforeAction="onSubmit()" cancelRule="true" isReset="true" listener="onTradeSubmit" refreshPart=""  area="AuthPart,InitInfoHidePart,TradeInfoHidePart,BaseInfoPart,CustInfoPart,CheckSimCardNoHidePart,CheckSerialNumberHidePart,OtherInfoHidePart" element="div"/>
	<!-- 提交 结束 -->
</div>
<!-- 区域 结束 -->

</div></div>
<input jwcid="@Hidden" name="STAFF_ID" id="STAFF_ID" value="ognl:getVisit().getStaffId()"/>
<script>
/*
*@chenxy3@REQ201501160002 关于BOSS系统开户界面限制身份证号手工录入的需求
*适用开户、代理商开户
*新增获取部门类型编码，如果是100或者500以外的部门控制证件类型为身份证，禁用手动录入
*/
window.onload=function(){
	/*
	var type = $("#OPEN_TYPE").val();
	if(type == "IOT_OPEN")//物联网开户
	{	
	   $("#USER_TYPE_CODE").attr("disabled",true);
	}
	*/
	
	var opentype = $("#OPEN_TYPE").val();
	
	var departKindCode=$("#DEPART_KIND_CODE").val(); 
	var staffv=$("#STAFF_ID").val().substring(0,4); 
	
	if(departKindCode!=""&&departKindCode!="100"&&departKindCode!="500"&&staffv!="HNSJ"&&staffv!="HNHN"&&staffv!="SUPERUSR"){ 
				$("#PSPT_TYPE_CODE").empty();
				$("#PSPT_TYPE_CODE").append("<option value='0'>本地身份证</option>");
				$("#PSPT_TYPE_CODE").append("<option value='1'>外地身份证</option>");
				if(opentype == "IOT_OPEN")	//物联网开户
				{
				   $("#PSPT_TYPE_CODE").append("<option value='D'>单位证明</option>");
				}
				$("#PSPT_TYPE_CODE").append("<option value='3'>军人身份证</option>");
				$("#PSPT_ID").attr("disabled",true);
				$("#CUST_NAME").attr("disabled",true);
				$("#PSPT_ADDR").attr("disabled",true);
				$("#BIRTHDAY").attr("disabled",true); 
	}
}
//页面关闭时调用释放资源流程
window.onunload=function(){
	var oldSerialNumber =  $("#OLD_SERIAL_NUMBER_B").val();
	var oldSimCardNo = $("#OLD_SIM_CARD_NO_B").val();
	var type = $("#OPEN_TYPE").val();	
	$.ajax.submit(null, 'releaseSingleRes', '&SERIAL_NUMBER='+oldSerialNumber+'&SIM_CARD_NO='+oldSimCardNo+'&TYPE='+type, null, function(data) {
	   return true;
	});
} 
</script>	
</body>
</html>