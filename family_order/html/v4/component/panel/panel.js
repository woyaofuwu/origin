!function($){"undefined"==typeof $.panel&&($.panel=function(t){return new $.panel.fn.construct(t)},$.panel.fn={construct:function(t){this.id=t,this.init()},init:function(){var t=this.id,e=$("#"+t),i=e.data("inited");if(!i){var a=-1;if(e.children("[x_panel_type]").each(function(i){if($.attr(this,"idx",i),$.attr(this,"class","c_acc"),"true"==$.attr(this,"keepOpen")?($.attr(this,"active","true"),a=i):"true"==e.attr("openAll")?$.attr(this,"active","true"):"true"==e.attr("closeAll")?$.attr(this,"active","false"):"true"==$.attr(this,"active")&&(a=i),"iframe"==$.attr(this,"x_panel_type")){var n=$("#"+t+" [idx="+i+"] iframe");if(n){n.bind("load",$.panel.fn.events.onIframeLoad);var s="x-panel-ld_"+$.guid++;$.insertHtml("afterend",n,'<div id="'+s+'" class="c_tabLoading" style="height:100%;display:block;"><span><i class="e_ico-loading"></i>'+$.lang["view.web.jcl.tapestry.page.loading"]+"</span></div>"),n.data("ld_id",s)}}if("content"==$.attr(this,"x_panel_type")){var r=0,l=$(this).find("div[x_panle_ct=content]:first"),c=l.children(".c_tree,.c_msg,.c_article,.c_form-text");void 0!=c&&c.length>0&&(r+=c.length);var d=l.children(".c_list");void 0!=d&&d.length>0&&d.each(function(){d.attr("class").indexOf("c_list-table")==-1&&r++}),r>1&&l.addClass("c_accContent-mix")}var h=$.attr(this,"titleFn");if(void 0!=h&&""!=h){$(this).find("a[x_panle_ct=title]:first").removeClass("e_center");var o=$(this).find("div[class=fn]:first"),p=$("#"+h);p&&(p.children().each(function(t){o.append($(this).clone(!0))}),p.remove())}else $(this).find("a[x_panle_ct=title]:first").addClass("e_center")}),e.find("a[x_panle_ct=title]").bind("click",$.panel.fn.events.onPanelTitleClick),e.data("inited",!0),e.data("active_idx",a),"true"==e.attr("openAll")&&e.attr("showScroll","true"),"false"==e.attr("openAll")&&"true"==e.attr("closeAll"))return;this.refreshPanel(!0)}},switchTo:function(t,e){if(t&&$.isString(t)){void 0==e&&(e=!0);var i=$("#"+this.id+" [panel_title='"+t+"']:first"),a=i.attr("idx"),n=$("#"+this.id),s=n.data("active_idx");s!=a&&"true"!=i.attr("keepOpen")&&("true"==n.attr("openAll")?(i.attr("active",!("true"==i.attr("active"))+""),n.data("active_idx",-1)):(n.children("[x_panel_type]").each(function(t){"true"==$.attr(this,"active")&&"false"==$.attr(this,"keepOpen")&&$.attr(this,"active","false")}),i.attr("active","true"),n.data("active_idx",a)),this.refreshPanel())}},switchToByIdx:function(idx,active,height){var panel=$("#"+this.id),item=$("#"+this.id+" [idx="+idx+"]");if(item)if(active){var ct_content=item.find("div[x_panle_ct=content]:first");if("false"==panel.attr("showScroll")&&height&&height>0?(ct_content.attr("style","height:"+height+"px;"),ct_content.height()>height&&ct_content.addClass("c_scroll")):(ct_content.attr("style","height:"+ct_content.attr("height")+"px;"),ct_content.removeClass("c_scroll")),item.attr("active","true"),item.attr("class","c_acc c_acc-on"),"iframe"==item.attr("x_panel_type")){var subFrame=$("#"+this.id+" [idx="+idx+"] iframe");if(!subFrame)return;var inited=subFrame.data("inited"),fresh=subFrame.attr("fresh");if(!inited||"true"==fresh){var page=subFrame.attr("page"),listener=subFrame.attr("listener"),params=subFrame.attr("params"),subsys=subFrame.attr("subsys"),url,p="";null!=params&&""!=params?(params.search(/[\"|\']\+\s*[\$]\(/)==-1&&params.search(/[\"|\']\+\s*(document.getElement)/)==-1||(params=eval(params)),$.each(params.split("&"),function(t,e){var i=e.indexOf("=");p+=i!=-1?"&"+e.substring(0,i)+"="+encodeURIComponent(e.substring(i+1)):"&"+e+"="})):p=null,url=subsys?$.redirect.buildUrl(subsys,page,listener,p):$.redirect.buildUrl(page,listener,p),subFrame.attr("src",url),subFrame.data("inited",!0)}}else $.resizeHeight&&$.resizeHeight()}else item.attr("active","false"),item.attr("class","c_acc")},get:function(t){return window["Panel_"+t]},getCurrentTitle:function(){var t=$("#"+this.id).data("active_idx");if(/^\d+$/.test(t))return $("#"+this.id+" [idx="+t+"]").attr("panel_title")},getCurrentContentWindow:function(){var t=$("#"+this.id).data("active_idx");if(/^\d+$/.test(t)){var e=$("#"+this.id+" [idx="+t+"]");if("iframe"==e.attr("x_panel_type"))return $("#"+this.id+" [idx="+t+"] iframe:first")[0].contentWindow}},getContentWindow:function(t){if(t&&$.isString(t)){var e=$("#"+this.id+" [panel_title='"+t+"']:first");return"iframe"==e.attr("x_panel_type")?e.find("iframe:first")[0].contentWindow:void 0}},getAllPanelTitle:function(){var t=[];return $("#"+this.id).children("[x_panel_type]").each(function(e,i){t[e]=$.attr(this,"panel_title")}),t},addPanelContent:function(t,e,i,a,n,s,r){t&&$.isString(t)&&i&&$.isString(i)&&this.addPanelItem("PanelContent",t,e,a,i,null,n,s,r)},addPanelFrame:function(t,e,i,a,n,s,r,l,c,d){if(t&&$.isString(t)&&a&&$.isString(a)){var h=[],o=null;h.push(' page="'),h.push(a),h.push('" '),n&&$.isString(n)&&(h.push(' listener="'),h.push(n),h.push('" ')),s&&$.isString(s)&&(h.push(' params="'),h.push(s),h.push('" ')),r&&$.isString(r)&&(h.push(' subsys="'),h.push(r),h.push('" ')),h.length>0&&(o=h.join("")),this.addPanelItem("PanelFrame",t,e,i,null,o,l,c,d)}},addPanelItem:function(t,e,i,a,n,s,r,l,c){if(e&&$.isString(e)){var d="";"PanelContent"==t?d="content":"PanelFrame"==t&&(d="iframe");var h=$("#"+this.id).children("[x_panel_type]").length,o=[];o.push('<div x_panel_type="'+d+'" class="c_acc" panel_title="'+e+'" '),a&&$.isString(a)&&""!=a&&o.push('titleFn="'+a+'" '),l?(o.push('keepOpen="'+l+'" '),r=!0):o.push('keepOpen="false" '),o.push('active="'+r+'" '),"PanelContent"==t&&o.push(s),o.push(' idx="'+h+'">\n\t'),o.push('<div class="c_accTitle">\n\t\t'),o.push('<a x_panle_ct="title" href="#nogo" class="text'),a&&$.isString(a)&&""!=a?(o.push('">'+e+"</a>\n\t"),o.push('\t<div class="fn"></div>')):o.push(' e_center">'+e+"</a>\n\t"),o.push('</div>\n\t<div x_panle_ct="content" class="c_accContent"');var p=[];null!=c&&""!=c&&(p.push("height:"),p.push(c),p.push(";")),p.length>0&&o.push(' style="'+p.join("")+'"'),o.push(' height="'+c+'"'),o.push(">\n\t"),"PanelFrame"==t&&(o.push('<iframe id="F-PanelFrame-'+h+'" name="F-PanelFrame-'+h+'" frameborder="no" '),o.push('style="width:100%;height:100%;display:none;" '+s+"></iframe>")),o.push("\n\t</div>\n</div>"),/^\d+$/.test(i)?0==i?$.insertHtml("afterbegin",$("#"+this.id),o.join("")):$.insertHtml("beforebegin",$("#"+this.id).children("[x_panel_type]")[i],o.join("")):$.insertHtml("beforeend",$("#"+this.id),o.join(""));var f=$("#"+this.id+" [idx="+h+"]");if(f.find("a[x_panle_ct=title]:first").bind("click",$.panel.fn.events.onPanelTitleClick),a&&$.isString(a)&&""!=a){var u=f.find("div[class=fn]:first"),_=$("#"+a);_&&(_.children().each(function(t){u.append($(this).clone(!0))}),_.remove())}if("PanelContent"==t){var v=0,g=f.find("div[x_panle_ct=content]:first"),x=$("#"+n);if(x){var m=x.clone(!0);x.remove(),g.append(m)}var w=g.children(".c_tree,.c_msg,.c_article,.c_form-text");void 0!=w&&w.length>0&&(v+=w.length);var y=g.children(".c_list");void 0!=y&&y.length>0&&y.each(function(){y.attr("class").indexOf("c_list-table")==-1&&v++}),v>1&&g.addClass("c_accContent-mix")}else if("PanelFrame"==t){var b=$("#"+this.id+" [idx="+h+"] iframe");if(b){b.bind("load",$.panel.fn.events.onIframeLoad);var P="x-panel-ld_"+$.guid++,C="";null!=c&&""!=c&&(C=c),$.insertHtml("afterend",b,'<div id="'+P+'" class="c_tabLoading" style="height:'+C+';display:none;"><span><i class="e_ico-loading"></i>'+$.lang["view.web.jcl.tapestry.page.loading"]+"</span></div>"),b.data("ld_id",P)}}r&&$("#"+this.id).data("active_idx",h),this.refreshPanel()}},refreshPanel:function(t){var e=this.id,i=$("#"+e),a=i.children("[x_panel_type]");if(a&&!(a.length<1)){var n=[],s=!1,r=$("#"+e+" div[titleFn]");if(r&&r.length>0&&(s=!0),a.each(function(t){s?$(this).find("a[x_panle_ct=title]:first").removeClass("e_center"):$(this).find("a[x_panle_ct=title]:first").addClass("e_center"),"true"==$.attr(this,"active")&&n.push($.attr(this,"idx")),$.attr(this,"class","c_acc")}),"true"==i.attr("openAll")){i.attr("showScroll",!0);for(var l=0;l<n.length;l++)""!=n[l]&&this.switchToByIdx(n[l],!0);i.data("active_idx",-1)}else{var c=i.data("active_idx"),d=i.children("[keepOpen=true]"),h=i.height()-$("#"+this.id+" [idx=0]").height()*a.length,o=h,p=null;t?c<0&&a.length>0&&(c=0,n.push(c)):(n=[],c>-1&&n.push(c),d&&d.length>0&&d.each(function(t){$.attr(this,"idx")!=c&&n.push($.attr(this,"idx"))})),p=Math.floor(h/n.length),"true"==i.attr("showScroll")?(o=null,p=null):o=h-p*(n.length-1);for(var l=0;l<n.length;l++)n[l]+""!=""&&(l==n.length-1?this.switchToByIdx(n[l]+"",!0,o):this.switchToByIdx(n[l]+"",!0,p));i.data("active_idx",c)}this.refreshScroll(e)}},refreshScroll:function(t){var e=$("#"+t),i=e.children("[x_panel_type]");if(i&&!(i.length<1)&&"true"==e.attr("showScroll")){var a=0;i.each(function(t){a+=e.find("[idx="+$.attr(this,"idx")+"]").height()}),a>e.height()?e.addClass("c_scroll"):e.removeClass("c_scroll")}},setOpenAll:function(t){$("#"+this.id).attr("openAll",t+""),this.showScroll(t),t&&$("#"+this.id).children("[x_panel_type]").each(function(t){$.attr(this,"active","true")})},setKeepOpen:function(t,e){if(t&&$.isString(t)){var i=$("#"+this.id+" [panel_title='"+t+"']:first");i.attr("keepOpen",e+"")}},showScroll:function(t){$("#"+this.id).attr("showScroll",t+"")},showIframeContent:function(t){var e=window.Wade_hasEdgeBetweenPage,i=window.Wade_isStopResizeHeight;window.Wade_hasEdgeBetweenPage=!1,window.Wade_isStopResizeHeight=!1,t.contentWindow.resizeHeight&&t.contentWindow.resizeHeight(),window.Wade_hasEdgeBetweenPage=e,window.Wade_isStopResizeHeight=i,$.data(t,"loaded",!0);var a=$(t).parents("div[x_panel]"),n=a.attr("id");this.refreshScroll(n);var s=$.data(t,"ld_id");$("#"+s).css("display","none"),$(t).css("display",""),$(t).css("width","100%"),$(t).css("height","100%")},events:{onPanelTitleClick:function(t){var e=$(this).parents("div[x_panel_type]"),i=e.parents("div[x_panel]"),a=e.attr("idx"),n=i.attr("id"),s=i.data("active_idx");if(s!=a){var r=$("#"+n+" [idx="+a+"]"),l=$("#"+n+" [idx="+s+"]"),c=l.attr("panel_title"),d=r.attr("panel_title"),h=!1;"true"==r.attr("keepOpen")&&(h=!0),window["Panel_"+n].switchAction&&$.isFunction(window["Panel_"+n].switchAction)&&window["Panel_"+n].switchAction(c,d)===!1||"true"!=r.attr("keepOpen")&&("true"==i.attr("openAll")?(r.attr("active",!("true"==r.attr("active"))+""),i.data("active_idx",-1)):h?r.attr("active","false"):(r.attr("active","true"),l.attr("active","false"),i.data("active_idx",a)),window["Panel_"+n].refreshPanel())}},onIframeLoad:function(t){$.panel.fn.showIframeContent(this)}}},$.panel.fn.construct.prototype=$.panel.fn,$.panel.get=$.panel.fn.get)}(Wade);