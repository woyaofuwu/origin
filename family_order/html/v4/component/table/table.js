!function(t){"undefined"==typeof t.table&&(t.table=function(e,a){return new t.table.fn.construct(e,a)},t.table.fn={construct:function(e,a){this.name="Table_"+e,this.tabName=e,this.tabHead=null,this.tag="tag",this.tabHeadSize=0,a&&(this.row_click_event=a.row_click_event,this.row_dblclick_event=a.row_dblclick_event,this.column_click_event=a.column_click_event,this.column_dblclick_evnent=a.column_dblclick_evnent),this.bindTableClickEvent(),this.getTableHead(),this.slipTable(this.tabName),t.extend(this,a)},getTable:function(){return t("#"+this.tabName)},selectedRow:function(e,a){var n=t.table.fn.get(e),l=n.getTable().attr("selected");if(null==l||"-1"==l)a.className&&t.attr(a,"raw_class",a.className),t.attr(a,"class","on");else{var s=n.getSelected();s&&s.length&&(s.attr("raw_class")?(s.attr("class",s.attr("raw_class")),s.attr("raw_class",null)):s.attr("class","")),a.className&&t.attr(a,"raw_class",a.className),t.attr(a,"class","on")}n.getTable().attr("selected",a.rowIndex)},setRowCss:function(t,e){t&&t.length&&(null!=e&&""!=e&&e.indexOf("style=")!=-1&&t.attr("style",e.substring(7)),t.attr("class",e),t.attr("raw_class",e))},bindTableClickEvent:function(){this.getTable().bind("click",[this.tabName],function(e){var a=t.table.fn.findParent(e.target,"TH");if(a)return!0;var n=t.table.fn.findParent(e.target,"TD"),l=t.table.fn.findParent(e.target,"TR");return l&&t.table.fn.selectedRow(e.data,l),n&&window["Table_"+e.data]&&window["Table_"+e.data].column_click_event&&t.isFunction(window["Table_"+e.data].column_click_event)&&window["Table_"+e.data].column_click_event(e),l&&!t("th:first",l).length&&window["Table_"+e.data]&&window["Table_"+e.data].row_click_event&&t.isFunction(window["Table_"+e.data].row_click_event)&&window["Table_"+e.data].row_click_event(e),!0}),this.getTable().bind("dblclick",[this.tabName],function(e){var a=t.table.fn.findParent(e.target,"TH");if(a)return!0;var n=e.data[0],l=t.table.fn.findParent(e.target,"TD"),s=t.table.fn.findParent(e.target,"TR");if(s&&t.table.fn.selectedRow(n,s),l){var r=t("#"+n+" th:nth-child("+(l.cellIndex+1)+")"),i=t(l);if(r&&r.length){var c=r.attr("type");if(c&&""!=c){var u=i.attr("done");if(!u){var o=(""+i.text()).replace(/\r|\n|\s/gi,""),d=i.attr("value");d||(d=o);var p=t.style(l,"width");p||t.style(l,"width",i.width()+"px"),i.addClass("edit");var h=[];switch(c){case"select":h.push('<span class="e_select" tag="edit"><span><span><select>');var b=r.attr("options");if(b&&""!=b){b=b.split("○");for(var f,g=0;g<b.length;g++)f=(""+b[g]).split("●"),h.push('<option value="'+f[1]+'" '+(d==f[1]?"selected":"")+">"+f[0]+"</option>")}h.push("</select></span></span></span>");break;case"datefield":var v=r.attr("arguments");h.push('<span class="e_elements" tag="edit">'),h.push('<button class="e_button-right" onclick="javascript:$(\'input[type=text]\',this.parentNode).trigger(\'click\');$.event.fix(event).stop();return false;"><i class="e_ico-date"></i><span></span></button>'),h.push('<span class="e_input e_input-left"><span>'),h.push('<input type="text" value="'+d+'" '+v),h.push(' onclick="javascript:var e;if(e=$.event.fix(event)){$.datefield.events.onInputClick(e);e.stop();return false;}"'),h.push(' onkeydown="javascript:var e;if(e=$.event.fix(event)){if(!$.datefield.events.onInputKeyDown(e)){e.stop();return false;}}"'),h.push(' ondblclick="javascript:$.event.fix(event).stop();return false;" />'),h.push("</span></span>"),h.push("</span>");break;case"popup":var w="popupText_"+ ++t.guid,_="popupValue_"+ ++t.guid,m=r.attr("isReadOnly"),v=r.attr("arguments");v=v.replace("{params}",""),v=v.replace("{eventId}",_),v=v.replace("{frameName}",""),h.push('<span class="e_elements" tag="edit">'),h.push('<button class="e_button-right" onclick="javascript:popupPage.apply(window,\''+v+"'.split('○'));\"><i class=\"e_ico-check\"></i><span></span></button>"),h.push('<span class="e_input e_input-left"><span><input id="'+w+'"'),1==m&&h.push(" readOnly=readOnly "),h.push(' type="text" value="'+o+'" /><input id="'+_+'" textName="'+w+'" afterAction="'+r.attr("afterAction")+'" type="hidden" value="'+d+'"/></span></span>'),h.push("</span>");break;default:h.push('<span class="e_input" tag="edit"><span>'),h.push('<input type="text" value="'+d+'"'),h.push(' onclick="javascript:$.event.fix(event).stop();return false;" '),h.push(' ondblclick="javascript:$.event.fix(event).stop();return false;" />'),h.push("</span></span>")}i.html(h.join(""))}i.attr("done",!0),i.find("input:first").select()}}window["Table_"+n]&&window["Table_"+n].column_dblclick_event&&t.isFunction(window["Table_"+n].column_dblclick_event)&&window["Table_"+n].column_dblclick_event()}return s&&!t("th:first",s).length&&window["Table_"+n]&&window["Table_"+n].row_dblclick_event&&t.isFunction(window["Table_"+n].row_dblclick_event)&&window["Table_"+n].row_dblclick_event(),!0})},findParent:function(t,e){var a=null;if(t){a=t;for(var n=0;null!=a&&"TABLE"!=a.nodeName&&n<10;){if(a.nodeName==e)return a;a=a.parentNode,n++}}return null},getTableHead:function(){var e=new t.DataMap;t("th",this.getTable()[0]).each(function(a,n){t(n).attr("col")&&e.put(t(n).attr("col"),a)}),this.tabHead=e,this.tabHeadSize=t("#"+this.tabName+" thead:first").children().length},addContextMenu:function(e,a){var n=t.table.fn.findParent(a.target,"TR");n&&t.table.fn.selectedRow(e,n)},clickRow:function(e){var a=this.getTable().attr("selected");if(null==a||"-1"==a)t(e).attr("class","on");else{var n=this.getSelected();n&&n.length&&(n.attr("raw_class")?n.attr("class",n.attr("raw_class")):n.attr("class","")),t(e).attr("class","on")}this.getTable().attr("selected",e.rowIndex)},addRow:function(e,a,n,l){var s=t.table.get(this.tabName).getTable(),r=parseInt(null==a||""==a?s.attr("selected"):a,10),i=this.tabHead,c="";if(i.eachKey(function(a,l){var r=t("th[col="+a+"]",s[0]);if(c+="<td ",r&&r.css("display")&&"none"==r.css("display")&&(c+=" style='display:none'"),n&&n[a]?c+=' class="'+n[a]+'"':r&&r.attr("colcss")&&""!=r.attr("colcss")&&(c+=" class="+r.attr("colcss")),e[a]){var i=r.attr("source");if(i&&""!=i){var u=r.attr("values"),o="";t.each(u.split(","),function(t,a){o+=e[a]+","}),o.length>0&&(o=o.substring(0,o.length-1)),e[a]=translate(i,r.attr("names"),o,r.attr("key"),r.attr("default")),o=null,u=null}i=null,c+=" >"+e[a]+"</td>"}else c+=" ></td>"}),r!=-1){var u=t(s[0].rows[r]);return u&&u.length?(0==l?t.insertAfter(t(s[0].rows[r]),{tag:"tr",html:c},!0):t.insertAfter(t(s[0].rows[r]),{tag:"tr",status:"0","class":"new",raw_class:"new",html:c},!0),t(s[0].rows[r+1])):(alert(t.lang.get("table.addrow.index.isnull",r)),c=null,null)}return 0==l?t.append(t("tbody",s[0]),{tag:"tr",html:c},!0):t.append(t("tbody",s[0]),{tag:"tr",status:"0","class":"new",raw_class:"new",html:c},!0),c=null,t("tbody tr:last",s[0])},updateRow:function(e,a,n){var l=t.table.get(this.tabName).getTable(),s=parseInt(null==a||""==a?l.attr("selected"):a,10),r="nochange";if(s!=-1){var i,c=this.tabHead;return c.eachKey(function(a,n){if(e.hasOwnProperty(a)){i=e[a];var u=l[0].rows[s].cells[parseInt(c.get(a),10)];u.children[0]?t.nodeName(u.children[0],"input")?(t(u.children[0]).val()!=i&&(r="changed"),t(u.children[0]).val(i)):(t(u.children[0]).html()!=""+i&&(r="changed"),t(u.children[0]).html(""+i)):(t(u).html()!=""+i&&(r="changed"),t(u).html(""+i))}}),t(l[0].rows[s]).attr("status")||"changed"!=r||0==n||(t(l[0].rows[s]).attr("status","2"),t(l[0].rows[s]).attr("raw_class","edit")),t(l[0].rows[s])}return alert(t.lang.get("table.updaterow.index.isnull")),null},deleteRow:function(e,a){var n=t.table.get(this.tabName),l=n.getRowByIndex(e);return l&&l.length?(l.attr("raw_class","delete"),null!=a&&1!=a||(l.css("display","none"),l.attr("class","")),l.attr("status")?"0"==l.attr("status")?l.remove():"2"==l.attr("status")&&l.attr("status","1"):l.attr("status","1"),null==a||1==a?n.getTable().attr("selected",-1):n.getTable().attr("selected",l.rowIndex),l=null,void(n=null)):(n=null,void(l=null))},cleanRow:function(e){var a=t.table.get(this.tabName).getTable(),n=parseInt(a.attr("selected"),10),l=a[0].rows[n];if(l)for(var s=0;s<l.cells.length;s++)t(l.cells[s]).html("")},isDeleted:function(t){var e=this.getRowByIndex(t);return e&&e.length?"1"==e.attr("status"):(tab=null,e=null,!1)},isNew:function(t){var e=this.getRowByIndex(t);return e&&e.length?"0"==e.attr("status"):(tab=null,e=null,!1)},isUpdated:function(t){var e=this.getRowByIndex(t);return e&&e.length?"2"==e.attr("status"):(tab=null,e=null,!1)},getCheckedRows:function(e){var a=t.table.get(this.tabName).getTable(),n=[];return t("tbody input[type=checkbox],tbody input[type=radio]",a).each(function(a,l){if(t(l).attr("checked")&&(n.push(a),e&&t.isFunction(e))){var s=e.call(l,a,l);if(0==s)return!1}}),n},getCheckedRowDatas:function(e){var a=t.table.get(this.tabName).getTable(),n=new t.DatasetList,l=this.tabName;return t("tbody input[type=checkbox],tbody input[type=radio]",a).each(function(a,s){t(s).attr("checked")&&n.add(t.table.get(l).getRowData(e,a+1))}),n},getRowByIndex:function(e){var a=t.table.get(this.tabName).getTable(),n=null;return null==e?n=t(a[0].rows[parseInt(a.attr("selected"),10)]):t.isString(e)||t.isNumber(e)?n=t(a[0].rows[parseInt(e,10)]):e&&t.isObject(e)&&t.isNodeName(e[0],"TR")&&(n=t(e)),a=null,n},cleanRows:function(e){t("tbody",this.getTable()[0]).html(""),this.getTable().attr("selected","-1")},get:function(t){return window["Table_"+t]},getTableData:function(e,a){var n=new t.DatasetList,l=t.table.get(this.tabName),s=t("tbody",l.getTable()[0]),r=this.tabHeadSize;return a=null!=a&&1==a,s&&t("tr",s[0]).each(function(s,i){if(a){var c=l.getRowData(e,s+r);c&&(c.put("tag",t(i).attr("status")),n.add(c)),c=null}else if("0"==t(i).attr("status")||"1"==t(i).attr("status")||"2"==t(i).attr("status")){var c=l.getRowData(e,s+r);c&&(c.put("tag",t(i).attr("status")),n.add(c)),c=null}}),s=null,l=null,n},getColumnValue:function(e){if(e&&e.nodeType){var a,n=t("#"+this.tabName+" th:nth-child("+(e.cellIndex+1)+")"),l=n.attr("type"),s=t.attr(e,"done");if(l||s)switch(l){case"select":a=t("select:first",e).val();break;case"datefield":a=t("input:first",e).val();break;case"popup":a=t("input[type=hidden]:first",e).val();break;default:a=t("input:first",e).val()}else a=t("input:first",e).val(),void 0==a&&(a=t.attr(e,"value"),void 0==a&&(a=(""+t.trim(t(e).text())).replace(/\r|\n/gi,"")));return a}},getRowData:function(e,a){var n=this.getTable(),l=null==a?parseInt(n.attr("selected"),10):a,s=new t.DataMap;if(l>=0){var r=n[0].rows[l-this.tabHeadSize+1];if(null==r||"undefined"==r)return null;if(e&&""!=e){for(var i=e.split(","),c=0;c<i.length;c++)if(this.tabHead.containsKey(i[c])){var u=t(r.cells[parseInt(this.tabHead.get(i[c]),10)]);s.put(i[c],this.getColumnValue(u[0]))}i=null}else{var o=this,d=this.tabHead;d.eachKey(function(t,e){var a=r.cells[parseInt(d.get(t),10)];s.put(t,o.getColumnValue(a))}),d=null}s.put("tag",t(r).attr("status"))}return s},getSelected:function(e){var a=this.getTable()[0].rows[parseInt(this.getTable().attr("selected"),10)];if(a){if(null==e)return t(a);if(t.isNumber(e)){if(e>=0&&e<a.cells.length)return t(a.cells[e])}else if(t.isString(e)){var n=parseInt(this.tabHead.get(e),10);if(n>=0&&n<a.cells.length)return t(a.cells[n])}}return null},getCellByRowIndex:function(e,a){var n=this.getTable()[0].rows[parseInt(e,10)];if(n){if(null==a)return t(n);if(t.isNumber(a)){if(a>=0&&a<n.cells.length)return t(n.cells[a])}else if(t.isString(a)){var l=parseInt(this.tabHead.get(a),10);if(l>=0&&l<n.cells.length)return t(n.cells[l])}}return null},isPrimary:function(e,a,n){if(null==e||""==e)return!1;var l="",s="";if(t.each(e.split(","),function(t,e){s+=a[e]}),null!=n){var r=this.getRowData(e,n);return!!r&&(l="",t.each(e.split(","),function(t,e){l+=r.get(e)}),s==l)}var i=this,c=!1;return t("#"+this.tabName+" tbody").children().each(function(a,n){var r=i.getRowData(e,a+i.tabHeadSize);if(l="",r&&t.each(e.split(","),function(t,e){l+=r.get(e)}),r=null,s==l)return void(c=!0)}),!!c},tableEventMouseUp:function(e){var a=t(e.target).parents("table"),n=a.data("Wade_Table_SlipStartX")-e.pageX,l=a.data("Wade_Table_SlipElemnt");if(t.removeData(a[0],"Wade_Table_SlipElemnt"),t.removeData(a[0],"Wade_Table_SlipStartX"),t("thead",a).unbind("mouseup",window["Table_"+a.attr("id")].tableEventMouseUp),0!==n&&l){for(var s=l.parent().prev();s.length&&"none"==s.css("display");)s=s.prev();s.css("width",s.width()-n),l.parent().css("width",l.parent().width()+n),document.onselectstart=function(){return!0}}},slipTable:function(e){var a=t("#"+e),n=t("thead th span[class=slip]",a);n.length>0&&(t("thead",a).bind("mousedown",function(e){"slip"!=t(e.target).attr("class")&&t("thead",a).unbind("mouseup",window["Table_"+a.attr("id")].tableEventMouseUp)}),n.bind("mousedown",function(e){t("thead",a).bind("mouseup",window["Table_"+a.attr("id")].tableEventMouseUp),a.data("Wade_Table_SlipElemnt",t(this)),a.data("Wade_Table_SlipStartX",e.pageX),document.onselectstart=function(){return!1}}))}},t.table.fn.construct.prototype=t.table.fn,t.table.get=t.table.fn.get)}(Wade);