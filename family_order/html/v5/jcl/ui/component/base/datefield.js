/*!
 * datefield component
 * http://www.wadecn.com/
 * auth:xiedx@asiainfo.com
 * Copyright 2015, WADE
 */
!function(c,i,p){"use strict";if(c&&"undefined"==typeof c.DateField){Array.prototype.push,Array.prototype.splice;var e=p.createElement("input"),t="oninput"in e;e=null;var o,l,n="undefined"!=typeof c.hasTouch?c.hasTouch:"ontouchstart"in i,s=n?"touchstart":"mousedown",d=c.os.phone||!0===c.ratioPhone,u="_Wade_DropDownCalendar",r=function(e,t){var n=this;n.el=e&&1==e.nodeType?e:p.getElementById(e),n.el&&n.el.nodeType&&(n.id=c.attr(n.el,"id"))&&(t&&c.isObject(t)&&c.extend(n,t),c.attr(n.el,"x-wade-uicomponent")||c.attr(n.el,"x-wade-uicomponent","datefield"),n._init(),n.constructor.call(n))};r.prototype=c.extend(new c.UIComponent,{val:function(e){var t=this;if(e==undefined)return t.el.value;t.value=t.el.value=e},refresh:function(){var e=this;e.spanEl||(e.spanEl=c(e.el).parent("span.e_mix:first")[0]);var t=e.spanEl.getBoundingClientRect();e.spanLeft=t.left,e.spanTop=t.top,e.spanHeight=e.spanEl.offsetHeight,e.spanWidth=e.spanEl.offsetWidth;var n=e.spanTop,a=(e.spanLeft,p.body),i=a.offsetHeight-e.spanHeight-n;c.isNumber(a.scrollTop)&&(e.spanTop+=a.scrollTop-2),c.isNumber(a.scrollLeft)&&(e.spanLeft+=a.scrollLeft),e.dir=n<=i?"down":"up";var o="down"==e.dir?i:n,l=0,s=0,d=p.getElementById(u+"_float");(" "+(d.className?d.className:"")+" ").indexOf(" c_float-show ")<0?(d.style.left="-99999px",d.style.top="-99999px",d.style.display="block",l=d.offsetWidth,s=d.offsetHeight,d.style.display=""):(l=d.offsetWidth,s=d.offsetHeight);var r=Math.min(o,s),f=document.documentElement.clientHeight;d.style.left=e.spanLeft+e.spanWidth-l+"px",d.style.top=s<=f&&n<s&&i<s?(f-s)/2+"px":("down"==e.dir?e.spanTop+e.spanHeight:e.spanTop-r)+"px"},getDisabled:function(){return this.disabled},setDisabled:function(e){var n=this;void 0!==e&&(n.disabled=!!e,n.el.disabled=n.disabled,setTimeout(function(){var e=n.spanEl?n.spanEl:n.el,t=e.className?e.className:"";n.disabled?(" "+t+" ").indexOf(" e_dis ")<0&&(e.className=c.trim(t+" e_dis")):(t=c.trim((" "+t+" ").replace(/ e_dis /gi," ")),e.className=t)},0))},getReadonly:function(){return this.readonly},setReadonly:function(e){var t=this;void 0!==e&&(t.readonly=!!e,setTimeout(function(){c.attr(t.el,"readonly",t.readonly)},0))},destroy:function(){var e=this;e.spanEl=null,e.icoEl=null,e.el=null},_init:function(){var a=this;if(a.spanEl=c(a.el).parent("span.e_mix:first")[0],a.icoEl=c(a.el).next("span.e_ico-date:first")[0],a.icoEl&&(a.icoEl.style.display=a.dropDown?"":"none"),(d||c.os.pad||a.readonly)&&a.setReadonly(!0),a.disabled&&a.setDisabled(!0),t?c(a.el).bind("input",function(e){this.value=(""+this.value).replace(/[^0-9-\/\s:]+/gi,"")}):c(a.el).keydown(function(e){return!(e.shiftKey||e.altKey||e.ctrlKey)&&(47<e.keyCode&&e.keyCode<58||95<e.keyCode&&e.keyCode<106||8==e.keyCode||46==e.keyCode||189==e.keyCode||191==e.keyCode)}),!0===a.dropDown){var e=function(e){if(!a.disabled&&!0===a.dropDown){e.originalEvent&&(e=e.originalEvent),o||(c(p.body).append('<div id="'+u+'_float" class="c_float'+(d?" c_float-phone-auto":"")+'" style="width:22em;"><div  id="'+u+'_float_bg" class="bg"></div><div  id="'+u+'_float_content" class="content"></div></div>'),o=c.Calendar.append(u+"_float_content",{name:u,className:"c_calendar"+(d?"":" c_calendar-s")}),c("#"+u).select(function(e){l&&i[l]&&i[l]instanceof r&&!0!==i[l].useTime&&!0===i[l].dropDown&&(i[l].val(this.val()),c.event.trigger("afterAction",null,i[l].el),f())}),c("#"+u).clear(function(e){l&&i[l]&&i[l]instanceof r&&!0===i[l].dropDown&&(i[l].val(""),c.event.trigger("afterAction",null,i[l].el)),f()}),c("#"+u).ok(function(e){if(l&&i[l]&&i[l]instanceof r&&!0===i[l].useTime&&!0===i[l].dropDown)return i[l].val(this.val()),c.event.trigger("afterAction",null,i[l].el),f(),!1}),c("#"+u+"_float_bg").bind(s,function(){f()})),o&&(c.extend(o,{now:a.now,format:a.format,value:a.value,useTime:a.useTime}),o.reset()),a.refresh();var t=p.getElementById(u+"_float"),n=t.className?t.className:"";(" "+n+" ").indexOf(" c_float-show ")<0&&(t.className=c.trim(n+" c_float-show")),l=a.id}};c(a.el).bind("tap",e),c(a.icoEl).bind("tap",e)}}}),c(function(){c(p.body).bind(s,function(e){if(e&&e.target){var t=e.target;if(t&&t.nodeType&&o){for(var n=0,a=!1;t&&t.nodeType&&t!=p.body&&n<50;){var i=c.attr(t,"id");if(i&&c.isString(i)&&(0==i.indexOf(l)||0==i.indexOf(u))){a=!0;break}t=t.parentNode,n++}a||f()}}}),c(i).bind("onorientationchange"in i?"orientationchange":"resize",function(){f()}),n||c(p.body).bind("mousewheel",function(e){f()})}),i.DateField=c.DateField=r}function f(){if(l){var e=p.getElementById(u+"_float");if(null!=e&&1==e.nodeType){var t=e.className?e.className:"";-1<(" "+t+" ").indexOf(" c_float-show ")&&(e.className=c.trim((" "+t+" ").replace(/ c_float-show /gi," ")))}l=e=null}}}(window.Wade,window,document);