SELECT TO_CHAR(A.TRADE_ID) TRADE_ID,
       A.ACCEPT_MONTH,
       TO_CHAR(A.BATCH_ID) BATCH_ID,
       TO_CHAR(A.ORDER_ID) ORDER_ID,
       TO_CHAR(A.PROD_ORDER_ID) PROD_ORDER_ID,
       A.BPM_ID,
       TO_CHAR(A.CAMPN_ID) CAMPN_ID,
       A.TRADE_TYPE_CODE,
       A.PRIORITY,
       A.SUBSCRIBE_TYPE,
       A.SUBSCRIBE_STATE,
       A.NEXT_DEAL_TAG,
       A.IN_MODE_CODE,
       TO_CHAR(A.CUST_ID) CUST_ID,
       A.CUST_NAME,
       TO_CHAR(A.USER_ID) USER_ID,
       TO_CHAR(A.ACCT_ID) ACCT_ID,
       A.SERIAL_NUMBER,
       A.NET_TYPE_CODE,
       A.EPARCHY_CODE,
       A.CITY_CODE,
       A.PRODUCT_ID,
       A.BRAND_CODE,
       TO_CHAR(A.CUST_ID_B) CUST_ID_B,
       TO_CHAR(A.USER_ID_B) USER_ID_B,
       TO_CHAR(A.ACCT_ID_B) ACCT_ID_B,
       A.SERIAL_NUMBER_B,
       A.CUST_CONTACT_ID,
       A.SERV_REQ_ID,
       A.INTF_ID,
       TO_CHAR(A.ACCEPT_DATE, 'yyyy-mm-dd hh24:mi:ss') ACCEPT_DATE,
       A.TRADE_STAFF_ID,
       A.TRADE_DEPART_ID,
       A.TRADE_CITY_CODE,
       A.TRADE_EPARCHY_CODE,
       A.TERM_IP,
       TO_CHAR(A.OPER_FEE) OPER_FEE,
       TO_CHAR(A.FOREGIFT) FOREGIFT,
       TO_CHAR(A.ADVANCE_PAY) ADVANCE_PAY,
       A.INVOICE_NO,
       A.FEE_STATE,
       TO_CHAR(A.FEE_TIME, 'yyyy-mm-dd hh24:mi:ss') FEE_TIME,
       A.FEE_STAFF_ID,
       A.PROCESS_TAG_SET,
       A.OLCOM_TAG,
       TO_CHAR(A.FINISH_DATE, 'yyyy-mm-dd hh24:mi:ss') FINISH_DATE,
       TO_CHAR(A.EXEC_TIME, 'yyyy-mm-dd hh24:mi:ss') EXEC_TIME,
       A.EXEC_ACTION,
       A.EXEC_RESULT,
       A.EXEC_DESC,
       A.CANCEL_TAG,
       TO_CHAR(A.CANCEL_DATE, 'yyyy-mm-dd hh24:mi:ss') CANCEL_DATE,
       A.CANCEL_STAFF_ID,
       A.CANCEL_DEPART_ID,
       A.CANCEL_CITY_CODE,
       A.CANCEL_EPARCHY_CODE,
       TO_CHAR(A.UPDATE_TIME, 'yyyy-mm-dd hh24:mi:ss') UPDATE_TIME,
       A.UPDATE_STAFF_ID,
       A.UPDATE_DEPART_ID,
       A.REMARK,
       A.RSRV_STR1,
       A.RSRV_STR2,
       A.RSRV_STR3,
       A.RSRV_STR4,
       A.RSRV_STR5,
       A.RSRV_STR6,
       A.RSRV_STR7,
       A.RSRV_STR8,
       A.RSRV_STR9,
       A.RSRV_STR10
  FROM TF_BH_TRADE A
  WHERE A.USER_ID=:USER_ID
  AND A.TRADE_TYPE_CODE ='110'
  AND SUBSTR(A.PROCESS_TAG_SET,9,1) ='2'
   AND SUBSTR(A.PROCESS_TAG_SET,12,1) ='0'
  AND A.CANCEL_TAG ='1'
  AND SYSDATE < A.EXEC_TIME
  AND a.ACCEPT_DATE =(
      SELECT MAX(B.ACCEPT_DATE) FROM TF_BH_TRADE B WHERE B.USER_ID = :USER_ID
      AND B.TRADE_TYPE_CODE ='110'
     AND SUBSTR(B.PROCESS_TAG_SET,9,1) ='2'
    AND SUBSTR(B.PROCESS_TAG_SET,12,1) ='0'
     AND B.CANCEL_TAG ='1'
     AND SYSDATE < B.EXEC_TIME 
  )