SELECT RES_NO,
       RES_TYPE_CODE,
       RES_STATE_CODE,
       OCCUPY_TYPE_CODE,
       RANDOM_NO,
       TO_CHAR(OCCUPY_TIME, 'yyyy-mm-dd hh24:mi:ss') OCCUPY_TIME,
       OCCUPY_DEPART_ID,
       OCCUPY_STAFF_ID,
       TO_CHAR(VALID_TIME, 'yyyy-mm-dd hh24:mi:ss') VALID_TIME,
       EPARCHY_CODE,
       REMARK,
       RSRV_TAG1,
       RSRV_TAG2,
       RSRV_TAG3,
       RSRV_DATE1,
       RSRV_DATE2,
       RSRV_DATE3,
       RSRV_STR1,
       RSRV_STR2,
       RSRV_STR3,
       RSRV_NUM1,
       RSRV_NUM2,
       RSRV_NUM3,
       SERIAL_NUMBER,
       TERMINAL_MODEL_CODE,
       PRODUCT_ID,
       PACKAGE_ID,
       IN_MODE_CODE,
       STAFF_ID,
       PRODUCT_NAME,
       PACKAGE_NAME,
       STOCK_ID,
       (SELECT A1.DEPART_NAME FROM TD_M_DEPART A1 WHERE A1.DEPART_ID = A.STOCK_ID) STOCK_DEPART_NAME,
       CITY_CODE,
       TRADE_ID,
       TERMINAL_ID,
       TO_CHAR(USE_TIME, 'yyyy-mm-dd hh24:mi:ss') USE_TIME,
       USE_DEPART_ID,
       USE_STAFF_ID
FROM TF_R_TERMINALOCCUPY a
WHERE 1 = 1
   AND A.RES_NO = :SERIAL_NUMBER
   AND A.RES_STATE_CODE=:PROCESS_TAG
   AND A.VALID_TIME > Sysdate 
 ORDER BY A.OCCUPY_TIME DESC