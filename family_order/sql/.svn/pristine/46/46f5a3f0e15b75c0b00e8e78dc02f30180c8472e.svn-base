--平台业务
SELECT 
       A.SEQ_NO,
       A.TRADE_TYPE_CODE,
       A.SUB_TRADE_TYPE,
       A.TRADE_TYPE,
       A.SERVICE_ID,
       A.SP_CODE SP_ID,
       DECODE(C.SP_NAME, '注册类业务', '中国移动', C.SP_NAME) SP_NAME,
       A.BIZ_CODE,
       B.SERVICE_NAME BIZ_NAME,
       C.SP_SHORT_NAME,
       E.BIZ_TYPE BIZ_TYPE,
       A.BIZ_TYPE_CODE,
       B.ORG_DOMAIN,
       B.BIZ_STATE_CODE,
       F.BILL_TYPE BILLFLG,
       F.PRICE  PRICE,
       B.serv_type,
       'Z' SERVICE_TYPE,
 (SELECT count(*)
          FROM TF_F_USER_PLATSVC G, TF_F_USER H
         WHERE G.USER_ID = :USER_ID
           AND G.PARTITION_ID = MOD(:USER_ID, '10000')
           AND SYSDATE BETWEEN G.START_DATE AND G.END_DATE
           AND (G.BIZ_STATE_CODE = 'A' OR G.BIZ_STATE_CODE = 'N')
           AND G.SERIAL_NUMBER = H.SERIAL_NUMBER
           AND H.REMOVE_TAG = '0'
           AND G.SERVICE_ID = A.SERVICE_ID
           AND G.SP_CODE = A.SP_CODE
           AND G.BIZ_CODE = A.BIZ_CODE
           AND G.BIZ_TYPE_CODE = A.BIZ_TYPE_CODE) orderflg			 
  FROM TD_S_WELCOME       A,
       TD_B_PLATSVC       B,
       TD_M_SP_INFO       C,
       TD_B_PLATSVC_PARAM E,
       TD_M_SP_BIZ        F
 WHERE A.TRADE_TYPE_CODE = '02'
   AND SYSDATE BETWEEN A.START_DATE AND A.END_DATE
   AND SYSDATE BETWEEN B.START_DATE AND B.END_DATE
   AND A.SERVICE_ID = B.SERVICE_ID
   AND A.SP_CODE = B.SP_CODE
   AND A.BIZ_CODE = B.BIZ_CODE
   AND A.BIZ_TYPE_CODE = B.BIZ_TYPE_CODE
   AND B.SERV_TYPE IN ('1', '0')
   AND A.SP_CODE = C.SP_CODE
   AND B.ORG_DOMAIN = E.ORG_DOMAIN
   AND B.SERV_TYPE = E.SERV_TYPE
   AND B.BIZ_TYPE_CODE = E.BIZ_TYPE_CODE
   AND A.SP_CODE = F.SP_CODE
   AND A.BIZ_CODE = F.BIZ_CODE
UNION ALL
--服务
SELECT 
       A.SEQ_NO,       
       A.TRADE_TYPE_CODE,
       A.SUB_TRADE_TYPE,
       A.TRADE_TYPE,
       A.ELEMENT_ID SERVICE_ID,
       '1001' SP_ID,
       '中国移动' SP_NAME,
       '' BIZ_CODE,
       B.SERVICE_NAME BIZ_NAME,
       '' SP_SHORT_NAME,
       '' BIZ_TYPE,
       '' BIZ_TYPE_CODE,
       '' ORG_DOMAIN,
       '' BIZ_STATE_CODE,
       DECODE(B.RSRV_STR4,'','2',B.RSRV_STR4) BILLFLG,
       B.RSRV_STR3  PRICE,
       '0' SERV_TYPE,
       A.ELEMENT_TYPE_CODE  SERVICE_TYPE,
			  (SELECT count(*)
          FROM TF_F_USER_SVC C
         WHERE C.USER_ID = :USER_ID
           AND C.PARTITION_ID = MOD(:USER_ID, '10000')
           AND SYSDATE BETWEEN C.START_DATE AND C.END_DATE
           AND C.SERVICE_ID = A.ELEMENT_ID) orderflg
  FROM TD_S_WELCOME A, TD_B_SERVICE B
 WHERE A.TRADE_TYPE_CODE = '01'
   AND A.ELEMENT_TYPE_CODE = 'S'
   AND SYSDATE BETWEEN A.START_DATE AND A.END_DATE
   AND SYSDATE BETWEEN B.START_DATE AND B.END_DATE
   AND A.ELEMENT_ID = B.SERVICE_ID
	 AND NOT EXISTS(SELECT 1 FROM TF_F_USER_SVC C, TD_S_WELCOME_MUTEX D
	     WHERE C.USER_ID = :USER_ID
			 AND C.PARTITION_ID = MOD(:USER_ID, '10000')
			 AND D.ELEMENT_ID = A.ELEMENT_ID 
			 AND D.ELEMENT_TYPE_CODE=A.ELEMENT_TYPE_CODE 
			 AND D.MUTEX_ID = C.SERVICE_ID
	     AND SYSDATE BETWEEN C.START_DATE AND C.END_DATE
			 AND SYSDATE BETWEEN D.START_DATE AND D.END_DATE )
UNION ALL
--优惠
SELECT 
       A.SEQ_NO,       
       A.TRADE_TYPE_CODE,
       A.SUB_TRADE_TYPE,
       A.TRADE_TYPE,
       A.ELEMENT_ID SERVICE_ID,
       '1001' SP_ID,
       '中国移动' SP_NAME,
       '' BIZ_CODE,
       B.DISCNT_NAME BIZ_NAME,
       '' SP_SHORT_NAME,
       '' BIZ_TYPE,
       '' BIZ_TYPE_CODE,
       '' ORG_DOMAIN,
       '' BIZ_STATE_CODE,
       DECODE(A.RSRV_STR1,'','2',A.RSRV_STR1) BILLFLG,
       A.RSRV_STR2  PRICE,
       '0' SERV_TYPE,
       A.ELEMENT_TYPE_CODE  SERVICE_TYPE,
			  (SELECT count(*)
          FROM TF_F_USER_DISCNT C
         WHERE C.USER_ID = 1105010802410054
           AND C.PARTITION_ID = MOD(1105010802410054, '10000')
           AND SYSDATE BETWEEN C.START_DATE AND C.END_DATE
           AND C.DISCNT_CODE = A.ELEMENT_ID) orderflg
  FROM TD_S_WELCOME A, TD_B_DISCNT B
 WHERE A.TRADE_TYPE_CODE = '01'
   AND A.ELEMENT_TYPE_CODE = 'D'
   AND SYSDATE BETWEEN A.START_DATE AND A.END_DATE
   AND SYSDATE BETWEEN B.START_DATE AND B.END_DATE
   AND A.ELEMENT_ID = B.DISCNT_CODE
	 AND NOT EXISTS (SELECT 1 FROM TF_F_USER_DISCNT C,TD_S_WELCOME_MUTEX D 
	     WHERE C.USER_ID = :USER_ID
			 AND C.PARTITION_ID = MOD(:USER_ID, '10000')
			 AND D.ELEMENT_ID = A.ELEMENT_ID 
			 AND D.ELEMENT_TYPE_CODE=A.ELEMENT_TYPE_CODE 
			 AND D.MUTEX_ID = C.DISCNT_CODE
	     AND SYSDATE BETWEEN C.START_DATE AND C.END_DATE
			 AND SYSDATE BETWEEN D.START_DATE AND D.END_DATE)	 
	 
 ORDER BY SEQ_NO