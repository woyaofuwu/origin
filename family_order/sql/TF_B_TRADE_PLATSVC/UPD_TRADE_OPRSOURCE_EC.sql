UPDATE TF_B_TRADE_PLATSVC A SET (A.OPR_SOURCE,A.RSRV_STR6)
= (SELECT DECODE(B.BIZ_STATE_CODE,'E',A.OPR_SOURCE,B.OPR_SOURCE),DECODE(B.BIZ_STATE_CODE,'E',A.RSRV_STR6,B.RSRV_STR6) 
     FROM TF_F_USER_PLATSVC B
    WHERE B.USER_ID = A.USER_ID AND 
          B.PARTITION_ID=MOD(A.USER_ID,10000)  AND
          B.SERVICE_ID = A.SERVICE_ID AND
          SYSDATE BETWEEN B.START_DATE AND B.END_DATE AND
          B.OPR_SOURCE = '64' AND
          ROWNUM = 1
   )
WHERE A.TRADE_ID = :TRADE_ID AND 
      EXISTS (SELECT 1 FROM TF_F_USER_PLATSVC 
               WHERE USER_ID = A.USER_ID AND
               PARTITION_ID=MOD(A.USER_ID,10000)  AND 
                     SERVICE_ID = A.SERVICE_ID AND
                     OPR_SOURCE = '64' AND
                     SYSDATE BETWEEN START_DATE AND END_DATE)