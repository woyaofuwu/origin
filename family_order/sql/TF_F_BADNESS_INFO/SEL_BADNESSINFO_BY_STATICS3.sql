SELECT BADNESS_INFO_PROVINCE,
       BADNESS_INFO,
       decode(IN_MODE_CODE,'01','全网','本地') IN_MODE,
       SUM(BLACK_SUM) BLACK_SUM,
       (SUM(COUNT_SUM) - SUM(BLACK_SUM)) NORMAL_SUM,
       SUM(COUNT_SUM) BADNESS_INFO_SUM
  FROM (SELECT T.BADNESS_INFO_PROVINCE,
               T.BADNESS_INFO,
               T.IN_MODE_CODE,
               1 BLACK_SUM,
               0 NORMAL_SUM,
               0 COUNT_SUM
          FROM TF_F_BADNESS_INFO T, TL_B_BLACKUSER B
         WHERE SUBSTR(B.SERIAL_NUMBER, 3, 11) = T.REPORT_SERIAL_NUMBER
           AND B.EFFECT_TAG = '1'
           AND (SYSDATE BETWEEN B.BEGIN_DATE AND B.END_DATE)
           AND (SUBSTR(T.SORT_RESULT_TYPE, 5, 2) = :REPORT_TYPE_CODE OR
                :REPORT_TYPE_CODE IS NULL)
           AND (SUBSTR(T.SORT_RESULT_TYPE, 7, 2) = :REPORT_CODE OR
                :REPORT_CODE IS NULL)
           AND (SUBSTR(T.SORT_RESULT_TYPE, 9, 2) =
                SUBSTR(:CONTENT_TYPE_CODE, 3, 2) OR
                :CONTENT_TYPE_CODE IS NULL)
           AND (T.RECV_IN_TYPE = :RECV_IN_TYPE OR :RECV_IN_TYPE IS NULL)
           AND (T.REPORT_BRAND_CODE = :REPORT_BRAND_CODE OR
                :REPORT_BRAND_CODE IS NULL)
           AND (T.BADNESS_INFO_PROVINCE = :BADNESS_INFO_PROVINCE OR
                :BADNESS_INFO_PROVINCE IS NULL)
           AND (T.REPORT_CUST_PROVINCE = :REPORT_CUST_PROVINCE OR
                :REPORT_CUST_PROVINCE IS NULL)
           AND (T.BADNESS_INFO = :BADNESS_INFO OR :BADNESS_INFO IS NULL)
           AND (trunc(T.REPORT_TIME) >= TO_DATE(:REPORT_START_TIME, 'yyyy-mm-dd') OR
                :REPORT_START_TIME IS NULL)
           AND (trunc(T.REPORT_TIME) <= TO_DATE(:REPORT_END_TIME, 'yyyy-mm-dd') OR
                :REPORT_END_TIME IS NULL)
           AND (T.STATE = :STATE OR :STATE IS NULL)
        UNION ALL
        SELECT T.BADNESS_INFO_PROVINCE,
               T.BADNESS_INFO,
               T.IN_MODE_CODE,
               0 BLACK_SUM,
               0 NORMAL_SUM,
               1 COUNT_SUM
          FROM TF_F_BADNESS_INFO T
         WHERE 1 = 1
           AND (SUBSTR(T.SORT_RESULT_TYPE, 5, 2) = :REPORT_TYPE_CODE OR
               :REPORT_TYPE_CODE IS NULL)
           AND (SUBSTR(T.SORT_RESULT_TYPE, 7, 2) = :REPORT_CODE OR
               :REPORT_CODE IS NULL)
           AND (SUBSTR(T.SORT_RESULT_TYPE, 9, 2) =
               SUBSTR(:CONTENT_TYPE_CODE, 3, 2) OR
               :CONTENT_TYPE_CODE IS NULL)
           AND (T.RECV_IN_TYPE = :RECV_IN_TYPE OR :RECV_IN_TYPE IS NULL)
           AND (T.REPORT_BRAND_CODE = :REPORT_BRAND_CODE OR
               :REPORT_BRAND_CODE IS NULL)
           AND (T.BADNESS_INFO_PROVINCE = :BADNESS_INFO_PROVINCE OR
               :BADNESS_INFO_PROVINCE IS NULL)
           AND (T.REPORT_CUST_PROVINCE = :REPORT_CUST_PROVINCE OR
               :REPORT_CUST_PROVINCE IS NULL)
           AND (T.BADNESS_INFO = :BADNESS_INFO OR :BADNESS_INFO IS NULL)
           AND (trunc(T.REPORT_TIME) >= TO_DATE(:REPORT_START_TIME, 'yyyy-mm-dd') OR
               :REPORT_START_TIME IS NULL)
           AND (trunc(T.REPORT_TIME) <= TO_DATE(:REPORT_END_TIME, 'yyyy-mm-dd') OR
               :REPORT_END_TIME IS NULL)
           AND (T.STATE = :STATE OR :STATE IS NULL)) A
 GROUP BY A.BADNESS_INFO_PROVINCE, A.BADNESS_INFO, A.IN_MODE_CODE
 ORDER BY A.BADNESS_INFO_PROVINCE, A.BADNESS_INFO, A.IN_MODE_CODE